<!DOCTYPE html>

<head>
    <meta charset="UTF_8" />
    <title>chat</title>

    <script type="text/javascript">
        function sendMsg() {

            if (document.getElementById("input_name").value != "") {
                fetch("/msg", {
                    method: "POST",
                    headers: { "Contet-Type": "application/json;charset=utf-8" },
                    body: JSON.stringify({ username: document.getElementById("input_name").value, message: document.getElementById("input_msg").value })
                });
                document.getElementById("input_msg").value = '';
            }
        }

        function getMsg() {
            fetch("/msg", { method: 'GET' })
                .then(response => { return response.text(); })
                .then(text => {
                    let messages = JSON.parse(text);
                    let str = '';

                    for (el of messages)
                        str += `${el.username}: ${el.message}<br>`;

                    document.getElementById("text_box").innerHTML = str;
                    reloadData();
                });
        }

        function reloadData() {
            setTimeout(getMsg, 500);
        }

        function enterKeySendForm(e) {
            if (e.keyCode == 13) {
                sendMsg();
            }
        };

    </script>
</head>

<body onload="reloadData()">
    <div class="center_text">
        <p id="text_box"></p>
    </div>

    <div class="center_input">
        <input id="input_name" placeholder="enter your name">
        <input id="input_msg" onkeypress="enterKeySendForm(event);" placeholder="enter your message">
        <input class="title button" type="button" onclick="sendMsg();" value="Send"
            style="color:blanchedalmond; background-color: #381abc; border-radius: 3px">
    </div>
</body>

</html>